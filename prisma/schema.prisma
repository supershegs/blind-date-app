// Prisma schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int          @id @default(autoincrement())
  username    String       @unique
  email       String       @unique
  password    String
  role        String       @default("user")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  isActive    Boolean      @default(true)
  isVerified  Boolean      @default(false)

  // relations
  profile            UserProfile?
  sentConnections    Connection[] @relation("SentConnections")
  receivedConnections Connection[] @relation("ReceivedConnections")
  sentMessages       Message[] @relation("SentMessages")
  receivedMessages   Message[] @relation("ReceivedMessages")
  proposedDatePlans  DatePlan[] @relation("ProposerDatePlans")

  @@map("users")
}

model UserProfile {
  id          Int      @id @default(autoincrement())
  userId      Int      @unique
  lastname    String   @db.VarChar(50)
  firstname   String   @db.VarChar(50)
  middlename  String?  @db.VarChar(50)
  dob         DateTime?
  phoneNum    String?  @db.VarChar(20)
  sex         String?  @db.VarChar(10)
  imageUpload String?  @db.Text
  address     String   @db.VarChar(200)
  state       String   @db.VarChar(50)
  city        String   @db.VarChar(50)
  localGovt   String   @db.VarChar(50)
  bio         String?  @db.VarChar(500)
  interest    String?  @db.VarChar(200)
  heightFt    Float?
  weightKg    Float?
  complexion  String?  @db.VarChar(50)
  hobbies     String?  @db.VarChar(200)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@map("user_profiles")
}

model Connection {
  id          Int      @id @default(autoincrement())
  senderId    Int
  receiverId  Int
  status      String   @default("pending") // pending, accepted, rejected
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sender      User     @relation("SentConnections", fields: [senderId], references: [id], onDelete: Cascade)
  receiver    User     @relation("ReceivedConnections", fields: [receiverId], references: [id], onDelete: Cascade)
  datePlans   DatePlan[] @relation("ConnectionDatePlans")

  @@unique([senderId, receiverId])
  @@map("connections")
}
model Message {
  id          Int      @id @default(autoincrement())
  senderId    Int
  receiverId  Int
  content     String   @db.Text
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sender      User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver    User     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId, receiverId])
  @@index([receiverId])
  @@map("messages")
}

model DatePlan {
  id            Int       @id @default(autoincrement())
  connectionId  Int       // Link to accepted connection
  proposerId    Int       // Who proposed the date
  dateTime      DateTime  // Proposed date & time
  location      String    @db.VarChar(200)
  notes         String?   @db.VarChar(500)
  status        String    @default("proposed") // proposed, accepted, declined, cancelled
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  connection    Connection @relation("ConnectionDatePlans", fields: [connectionId], references: [id], onDelete: Cascade)
  proposer      User       @relation("ProposerDatePlans", fields: [proposerId], references: [id], onDelete: Cascade)

  @@index([connectionId])
  @@map("date_plans")
}
